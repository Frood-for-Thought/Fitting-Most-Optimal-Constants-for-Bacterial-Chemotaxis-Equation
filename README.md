# Fitting-Most-Optimal-Constants-for-Bacterial-Chemotaxis-Equation
Bacteria use run-and-tumble mechanics to migrate towards food.  Running is when a bacteria's flagella propel it in a certain direction
with a constant speed.  Tumbling is when a rotation of the flagella cause the bacteria to stop and redirect itself for the next run.
This is how bacteria move around.  Given an attractant, (a food gradient), bacteria tumble less moving towards food and tumble more moving away.
This directed migration is called chemotaxis and and the speed bacteria travel directed up the food gradient is called the drift velocity.
For this simulation a drift velocity per position is known for a given food gradient.  
The goal is to use Data Analysis to filter out a list of potential constants per position for use in a stochastic run-and-tumble algorithm.
The constants control the probability of tumbling moving up and down the gradient.
By fitting the right constants, the random run-and-tumble algorithm velocity will resemble the known theoretical drift velocity.

## Programs
Each Folder has a file, "Program Info.txt", to describe all files and their uses in the project.
For data Analysis the project used Python and its libraries (Pandas, Scipy, Numpy, Matplotlib, Plotly, Seaborn), and MATLAB
For plotting the project used Jupyter Notebooks and Tableau.
A description of how the files were used is also given in Process.

## Process
### Diffusion Folder
- Find_Diff_RawData_Program.m calls the "Calc_D_Per_r_Deme_Function.m" program to generate
several distance data points using a run-and-tumble algorithm.
- input_parameters.xlsx are used by initializing parameters in the "Find_Diff_RawData_Program.m".
- The output of "Find_Diff_RawData_Program.m" generates the file,
"1.000_to_1.200_Diff_Conts_30001_DataPts_1000_Time.xlsx" which gives a list of 21 diffusion
constants from 1.00 to 1.20 with 30001 datapoints each.
- creating_analyzing_df.ipynb creates a dataframe out of the file "1.000_to_1.200_Diff_Conts_30001_DataPts_1000_Time.xlsx".
The diffusion data is grouped per diffusion constant and made into histograms, 
which then are cleaned to remove outliers or means which are outside a confidence interval.
The (unitless) diffusion constant accepted is one which has the lowest Bhattacharyya Distance from the theoretical 
Gaussian diffusion distribution, (D = 112 microns/s^2, t=1000s), and one which passes the Shapiro-Wilk test.
- creating_analyzing_df_table.py is a python file which generates the same table as "creating_analyzing_df.ipynb", but
graphing and plotting are further done in the "creating_analyzing_df.ipynb" file.

### Drift Velocity Folder
- The program to execute in order to generate the data to analyze is "Find_Alpha_RawData_Program.m". 
The data includes a list of potential alpha values per position and several velocity datappoints
from running a Monte Carlo run-and-tumble simulation.
- input_parameters.xlsx are used by initializing parameters in the "Find_Alpha_RawData_Program.m",
and "Tumble_Angle_Function.m" randomly finds the next angle the bacteria tumbles towards using the 
tumble angle distribution it was given for the run-and-tumble algorithm.
- Find_Alpha_RawData_Program.m uses the results of "Calc_V_Per_Alpha_Deme_Function.m" and 
"Calc_V_Per_Alpha_Deme_moreIter_Function" to calculate raw data points for multiple alpha 
values per deme and records everything into tables which contain the deme position, 
a range of alpha values, and a range of recorded velocities for the alpha values.
- The Python program "fit_alpha_constant" takes the raw data generated, cleans the outliers, 
then calculates the alpha value with the drift velocity closest to the theoretical, 
and puts all the results into the file "closest_alpha_const.csv".
- alpha_MaxC_60000_Grad_000405_CurveFit.m is the MATLAB program used for polynomial regressive analysis using
the file "closest_alpha_const.csv", which exports the polynomial curve fit results into the file
"alpha_values_MaxC_60000_Grad_0.000405_curve_fit".
- Run_and_Tumble_Algorithm_Temp_Stim_Chemotaxis.m reproduces the run-and-tumble chemotaxis migration of bacteria
as they are drawn towards a food sources, but is now reworked to include the alpha values curve fit 
from "alpha_values_MaxC_60000_Grad_0.000405_curve_fit".

### Data Analysis Folder
plotting.ipynb generates plots using the following data:
- The "input_parameters" file is used by the MATLAB programs to run the simulations.  It contains information on the
food gradient, theoretical drift velocity, run speed, and the bacteria receptor activity to the attractant (food).
- alpha_values_MaxC_60000_Grad_0.000405_curve_fit are the final alpha values by analyzing all the raw
data generated by "Calc_V_Per_Alpha_Deme_moreIter_Function".  
- The file alpha_values_MaxC_60000_Grad_0.000405_curve_fit are the final alpha values calculated by "fit_alpha_constant.py".
It also contains a polynomial regressive analysis curve fit created by "alpha_MaxC_60000_Grad_000405_CurveFit.m".
- pos_v_time_MaxC_60000_Grad_0.000405 files are plots of position vs time to be analyzed in the "plotting" file.
The pos_v_time files were outputs from the "Run_and_Tumble_Algorithm_Temp_Stim_Chemotaxis" file in the Drift Velocity Folder.

## Data Analysis
### Diffusion Constant
- Datapoints in the file "1.000_to_1.200_Diff_Conts_30001_DataPts_1000_Time.xlsx" are grouped according to 21 diffusion constants 
with a range from 1.00 to 1.20.  Each diffusion constant has 30001 datapoints each.
- The Python program "creating_analyzing_df_table.py" calculates all the descriptive statistics for the diffusion data for each constant.
It then cleans the datapoints which are > 3*standard_deviation from the mean, (the mean being 0), and removes any datasets which have 
a mean greater than 2*standard_error. 
- The theoretical distirbution for bacterial diffusion is a Gaussian probability distribution with a mean of 0, 
and a standard deviation of
```math
\sqrt{2Dt}
```
with
```math
D = 112\ microns/s^2,\ t = 1000s
```
- The program "creating_analyzing_df_table.py" finds a unitless run-and-tumble diffusion constant with a dataset that passes the Shapiro-Wilk test,
and has the lowest Bhattacharyya Distance from the theoretical Gaussian diffusion distribution.
- The diffusion constant closest to theoretical is d = 1.16, with a Bhattacharyya Distance = 0.000002.  The constant was tied with d = 1.15,
but an additional t-test showed that d = 1.16 had a t-statistic closer to the theoretical, (t-stat = -0.34, p-value = 0.73), 
compared to d = 1.15, (t-stat = -0.65, p-value = 0.51).  (A larger p-value means the null hypothesis is not pased and the two distributions are similar).

### Alpha Constants
- A drift velocity per position is known for a given food gradient.  
- For each position in the model, Find_Alpha_RawData_Program.m generates datasets of 2001 drift velocities for
several alpha values, and stores the data into a file for each position.
- The Python program "fit_alpha_constant.py" has a class which takes the raw data generated and calculates the descriptive statistics for each alpha dataset
 and cleans the outliers which are 3*standard_deviation from the mean.
- The class then then calculates the alpha value with the drift velocity closest to the theoretical by doing a one sample t-test.
- A loop goes over all files and puts all the alpha values per position with a distribution closest to the theoretical drift velocity into the file "closest_alpha_const.csv".
- alpha_MaxC_60000_Grad_000405_CurveFit.m is the MATLAB program used for polynomial regressive analysis using the file "closest_alpha_const.csv", 
which exports the polynomial curve fit results into the file "alpha_values_MaxC_60000_Grad_0.000405_curve_fit".
- The polynomial regressive curve fit:

```math
α(x) = b0 + b1x^9 + b2x^8 + b3x^7 + b4x^6 + b5x^5 + b6x^4 + b7x^3 + b8x^2 + b9x
```

with 
```math
Adjusted R^2=0.99906
```

Coefficients (with 95% confidence bounds):
- b0 =   1.819e+04  (1.741e+04, 1.896e+04)
- b1 =  -9.323e-12  (-1.175e-11, -6.897e-12)
- b2 =   4.688e-09  (3.519e-09, 5.858e-09)
- b3 =  -1.002e-06  (-1.241e-06, -7.622e-07)
- b4 =   0.0001191  (9.193e-05, 0.0001462)
- b5 =   -0.008684  (-0.01055, -0.006821)
- b6 =      0.4052  (0.3258, 0.4847)
- b7 =      -12.28  (-14.36, -10.2)
- b8 =       240.6  (208.9, 272.3)
- b9 =       -2922  (-3173, -2671)

### Run and Tumble Algorithm Trial Analysis
- Run_and_Tumble_Algorithm_Temp_Stim_Chemotaxis.m reproduces the run-and-tumble chemotaxis migration of bacteria using the fitted constants.
- The file "plotting.ipynb" analyzes several trial runs of the algorithm.
- For each trial, data of position vs time is gathered and drift velocity is calculated by taking the derivative.
- A histogram of the drift velocities show the distribution to be skewed towards the boundaries, with the mode near the positive boundary.
- For each trial the max and min velocity was the run speed of the bacteria.
- The modes for each trial have a variation of around 0.000000000001 µm/s, but small variations in the velocity distribution near the boundaries
is a good measure of how soon the bacteria will reach the end of the trial.
- The more skewed the polarization the greater the mean and median, and the faster the trial will end.
- There is higher variability at low food concentration starting from position 0 to 6200 µm, as this represents more random diffusion.
- By taking the position vs time data after 6200 µm and calculating an average slope of the speed, the drift velocity vs time plot resembles the 
theoretical drift velocity.
- However, as the drift velocity decreases, the difference in tumble probability going up the gradient and going down becomes smaller, 
so there is greater variability than at higher velocities.
